<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body, html {
            font-family: "Inter", sans-serif;
            height: 100%;
            margin: 0;
        }
        #dashboard {
            min-height: calc(100vh - 4rem);
        }
        .navbar {
            height: 4rem;
            background-color: white;
            border-bottom: 1px solid #e5e7eb;
        }
    </style>
</head>
<body class="bg-white">
    <!-- Navbar Section -->
    <div class="navbar flex items-center justify-between px-8">
        <div class="flex items-center space-x-4">
            <div class="text-xl font-bold">UXBoost AI</div>
            <nav class="flex space-x-4">
                <a class="nav-link text-gray-500 hover:text-black" href="#" onclick="setActiveNavLink(event)">Dashboard</a>
                <a class="nav-link text-gray-500 hover:text-black" href="#" onclick="setActiveNavLink(event)">Projects</a>
                <a class="nav-link text-gray-500 hover:text-black" href="#" onclick="setActiveNavLink(event)">Insights</a>
                <a class="nav-link text-gray-500 hover:text-black" href="#" onclick="setActiveNavLink(event)">History</a>
            </nav>
        </div>
        <div class="flex items-center space-x-4">
            <i class="fas fa-search text-gray-500"></i>
            <i class="fas fa-bell text-gray-500"></i>
            <img alt="User profile picture" class="rounded-full w-10 h-10" height="40" src="https://storage.googleapis.com/a1aa/image/dLZfX416xfrYw0KXdszwLdAMS4W6H7XVnSFl6dTpD1WeejgOB.jpg" width="40" />
        </div>
    </div>

    <!-- Dashboard Section -->
    <div id="dashboard" class="p-8">
        <div class="grid grid-cols-3 gap-6 h-full">
            <!-- Trending Headlines Section -->
            <div class="col-span-1 bg-gray-100 p-6 h-full border border-gray-300 shadow-lg">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold">Trending Headlines</h2>
                    <i class="fas fa-sync-alt text-gray-500 cursor-pointer" id="refresh-news" onclick="fetchHeadlines()"></i>
                </div>
                <ul class="space-y-4 h-full overflow-auto" id="headlines">
                    <!-- News items will be inserted here by JavaScript -->
                </ul>
            </div>

            <!-- Project and Stock Analysis Section -->
            <div class="col-span-2 grid grid-rows-2 gap-6">
                <div class="bg-gray-100 p-6 h-full border border-gray-300 shadow-lg">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-semibold">Recent Project</h2>
                        <div class="flex space-x-2">
                            <button class="button bg-black text-white py-1 px-3 rounded-full active" onclick="setActiveButton(event)">Standard view</button>
                            <button class="button bg-gray-200 text-gray-500 py-1 px-3 rounded-full" onclick="setActiveButton(event)">Heatmap</button>
                            <button class="button bg-gray-200 text-gray-500 py-1 px-3 rounded-full" onclick="setActiveButton(event)">Insights</button>
                            <button class="button bg-gray-200 text-gray-500 py-1 px-3 rounded-full" onclick="setActiveButton(event)">Skeleton view</button>
                        </div>
                        <i class="fas fa-ellipsis-h text-gray-500"></i>
                    </div>
                    <div class="flex justify-between items-center mb-4">
                        <img alt="Project image" class="w-1/2" height="200" src="C:\Users\manis\OneDrive\Desktop\mindspark\stocksent.jpg" width="600" />
                        <div class="w-1/2 pl-6">
                            <h3 class="text-xl font-semibold">Sentiment Analysis</h3>
                            <p class="text-gray-500 mt-2">The Future of Technology</p>
                            <div class="mt-4">
                                <input class="w-full p-2 border border-gray-300 rounded-lg" id="stock-search" placeholder="Search for a stock..." type="text" />
                                <button class="mt-2 bg-blue-500 text-white py-2 px-4 rounded-full" onclick="analyzeStock()">Analyze</button>
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <div class="text-center">
                            <p class="text-green-500 font-semibold">Transfer flow</p>
                            <p class="text-3xl font-bold">87%</p>
                        </div>
                        <div class="text-center">
                            <p class="text-orange-500 font-semibold">Request flow</p>
                            <p class="text-3xl font-bold">52%</p>
                        </div>
                        <div class="text-center">
                            <p class="text-gray-500">QR code for requesting funds is valid for only 1 minute.</p>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-6 h-full">
                    <div class="bg-gray-100 p-6 h-full border border-gray-300 shadow-lg">
                        <h2 class="text-lg font-semibold mb-4">Top Trending Stocks</h2>
                        <ul class="space-y-4 h-full overflow-auto" id="stocks-list">
                            <!-- Stock items will be inserted here by JavaScript -->
                        </ul>
                    </div>
                    <div class="bg-gray-100 p-6 h-full border border-gray-300 shadow-lg">
                        <h2 class="text-lg font-semibold mb-4">Stock Price Over Time</h2>
                        <canvas id="stockChart" class="h-full"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function setActiveNavLink(event) {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('text-black', 'font-semibold', 'active');
                link.classList.add('text-gray-500', 'hover:text-black');
            });
            event.currentTarget.classList.add('text-black', 'font-semibold', 'active');
        }

        function setActiveButton(event) {
            document.querySelectorAll('.button').forEach(button => {
                button.classList.remove('active');
                button.classList.add('bg-gray-200', 'text-gray-500');
            });
            event.currentTarget.classList.add('active', 'bg-black', 'text-white');
        }

        async function fetchHeadlines() {
    const apiKey = '9eca8bc96b9e453496b85e2ced9b8dfe';  // Replace with your actual NewsAPI key
    const query = 'stock trends';  // Adjust the query as needed
    const url = `https://newsapi.org/v2/everything?q=${encodeURIComponent(query)}&sortBy=publishedAt&apiKey=${apiKey}`;

    try {
        const response = await fetch(url);
        const data = await response.json();
        console.log(data);  // Log the response to check if articles are returned

        const headlinesList = document.getElementById('headlines');
        headlinesList.innerHTML = '';  // Clear existing headlines

        // Check if articles exist and populate the list
        if (data.articles && data.articles.length > 0) {
            data.articles.slice(0, 7).forEach(article => {
                const listItem = document.createElement('li');
                listItem.className = 'flex justify-between items-center';
                listItem.innerHTML = `
                    <span>${article.title}</span>
                    <a href="${article.url}" target="_blank" class="text-blue-500">Read more</a>
                `;
                headlinesList.appendChild(listItem);
            });
        } else {
            headlinesList.innerHTML = '<li class="text-red-500">No headlines available.</li>';
        }
    } catch (error) {
        console.error('Error fetching headlines:', error);
    }
}

// This function fetches and displays the top trending stocks.
async function displayTopStocks() {
    try {
        const response = await fetch('/get_top_stocks');
        const topStocks = await response.json();

        const stockListDiv = document.getElementById('stock-list');
        stockListDiv.innerHTML = '';  // Clear existing content

        if (topStocks.length > 0) {
            topStocks.forEach(stock => {
                const stockItem = document.createElement('div');
                stockItem.className = 'stock-item';
                stockItem.innerHTML = `
                    <span>${stock.Symbol}</span>
                    <span>Last Price: $${stock['Last Price'].toFixed(2)}</span>
                    <span>Change: $${stock.Change.toFixed(2)} (${stock['% Change'].toFixed(2)}%)</span>
                    <span>Volume: ${stock.Volume}</span>
                `;
                stockListDiv.appendChild(stockItem);
            });
        } else {
            stockListDiv.innerHTML = '<p>No trending stocks available.</p>';
        }
    } catch (error) {
        console.error('Error fetching top stocks:', error);
    }
}

// This function fetches and displays headlines on page load
window.onload = async () => {
    await fetchHeadlines();
    await displayTopStocks();
};


// Sample Chart.js setup (you can modify the data)
const ctx = document.getElementById('stockChart').getContext('2d');
const stockChart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
        datasets: [{
            label: 'Stock Price',
            data: [120, 150, 180, 130, 170, 160, 200],
            borderColor: 'rgba(75, 192, 192, 1)',
            backgroundColor: 'rgba(75, 192, 192, 0.2)',
            borderWidth: 1,
            fill: true,
        }]
    },
    options: {
        responsive: true,
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});

    </script>
</body>
</html>
